(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2603543c"],{"7a67":function(t,e,i){"use strict";i("fae5")},"8a1f":function(t,e,i){"use strict";i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return n}));i("498a");function a(t){return/^1[3|4|5|7|8|9][0-9]\d{8}$/.test(t)}function n(t){return/^(([1-9][0-9]*|0)\.([0-9]{1,2})$)|^([1-9][0-9]*|0)$/.test(t)}},b85c:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));i("a4d3"),i("e01a"),i("d3b7"),i("d28b"),i("3ca3"),i("ddb0"),i("fb6a"),i("b0c0"),i("a630");function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}function n(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return a(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==i.return||i.return()}finally{if(l)throw o}}}}},c4a9:function(t,e,i){"use strict";i.r(e);var a=i("b85c"),n=(i("d3b7"),i("ddb0"),i("b0c0"),i("a9e3"),i("a434"),i("caad"),i("3ca3"),i("2b3d"),i("8a1f")),r={name:"GardenVisualization",data:function(){return{userInfo:null,deviceList:[],draggingBtn:!1,activePoint:{name:"",partImg:"",device:"",area:"",color:"",humidityMin:"",humidityMax:"",active:!1,x:"",y:""},activeIdx:-1,loadingUpload:!1,ruleForm:{id:"",bgUrl:"",positionList:[],userId:""},rules:{name:[{required:!0,message:"请输入点位名称",trigger:"blur"}],area:[{required:!0,message:"请输入面积",trigger:"blur"}],color:[{required:!0,message:"请选择点位的颜色",trigger:"change"}],humidityMin:[{required:!0,message:"请输入最小值",trigger:"blur"}],humidityMax:[{required:!0,message:"请输入最大值",trigger:"blur"}],device:[{required:!0,message:"请选择绑定的设备",trigger:"change"}],partImg:[{required:!0,message:"请选择局部图片",trigger:"change"}]}}},created:function(){this.userInfo=JSON.parse(sessionStorage.getItem("userInfo")),this.ruleForm.userId=this.userInfo.id,this.loadData(),this.loadDevice()},methods:{goBack:function(){this.$router.go(-1)},addAnchorPoint:function(){var t,e=Object(a.a)(this.ruleForm.positionList.values());try{for(e.s();!(t=e.n()).done;){var i=t.value;if(!(i.name&&i.partImg&&i.device&&i.area&&i.color&&i.humidityMin&&i.humidityMax))return this.$message.warning("有定位点的相关信息未设置，请检查!"),!1;if(!Object(n.b)(i.area)||!Object(n.b)(i.humidityMin)||!Object(n.b)(i.humidityMax))return this.$message.warning("面积、湿度区间只能输入数字，且最多两位小数，请检查!"),!1;if(Number(i.humidityMin)>=Number(i.humidityMax))return this.$message.warning("湿度区间最大值必须大于最小值，请检查!"),!1}}catch(t){e.e(t)}finally{e.f()}this.ruleForm.positionList.push({name:"",partImg:"",active:!1,device:"",area:"",color:"",humidityMin:"",humidityMax:"",x:"40%",y:"50%"}),this.chooseAdr(this.ruleForm.positionList.length-1)},deleteAnchorPoint:function(){this.ruleForm.positionList.splice(this.activeIdx,1),this.activePoint={name:"",partImg:"",device:"",active:!1,area:"",color:"",humidityMin:"",humidityMax:"",x:"",y:""},this.activeIdx=-1},chooseAdr:function(t){if(this.activeIdx===t)return!1;var e,i=Object(a.a)(this.ruleForm.positionList.values());try{for(i.s();!(e=i.n()).done;){e.value.active=!1}}catch(t){i.e(t)}finally{i.f()}this.activeIdx=t,this.ruleForm.positionList[t].active=!0,this.activePoint=this.ruleForm.positionList[t]},toMove:function(t,e,i){var a=this,n=i.target,r=document.getElementById("garden-box").getBoundingClientRect(),o=r.left,s=r.top,l=r.width,c=r.height,u=i.clientX-o-n.offsetLeft,d=i.clientY-s-n.offsetTop,m=l-n.offsetWidth,g=c-n.offsetHeight;this.draggingBtn=!0,this.chooseAdr(e),document.onmousemove=function(e){if(a.draggingBtn){var i=e.clientX-o-u,n=e.clientY-s-d;return i<=0&&(i=0),i>=m&&(i=m),n<=0&&(n=0),n>=g&&(n=g),t.x=Math.floor(i/l*100)+"%",t.y=Math.floor(n/c*100)+"%",!1}},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null,a.draggingBtn=!1,t.stopPropagation()}},handleAvatarFail:function(){this.loadingUpload.close(),this.$message.error("上传失败!")},handleAvatarSuccess:function(t){this.loadingUpload.close(),4e4==t.code?(this.$message.success("上传成功!"),this.ruleForm.bgUrl=t.data):this.$message.error(t.message)},beforeAvatarUpload:function(t){var e=this,i=["image/jpeg","image/jpg","image/png"].includes(t.type),a=t.size/1024/1024<=20;return i?a?new Promise((function(e,i){var a=window.URL||window.webkitURL,n=new Image;n.onload=function(){n.width/n.height==2?e():i()},n.src=a.createObjectURL(t)})).then((function(){return t}),(function(){return e.$message({message:"请上传宽高比为2:1的图片，请重新选择!",type:"warning"}),Promise.reject()})):(this.$message.warning("上传背景图片大小不能超过 20MB!"),!1):(this.$message.warning("上传背景图片只能是 jpeg/jpg/png 格式!"),!1)},handleUploading:function(){this.loadingUpload=this.$loading({lock:!0,text:"请稍后..."})},handleAvatarFailPart:function(){this.loadingUpload.close(),this.$message.error("上传失败!")},handleAvatarSuccessPart:function(t){this.loadingUpload.close(),4e4==t.code?(this.$message.success("上传成功!"),this.activePoint.partImg=t.data):this.$message.error(t.message)},beforeAvatarUploadPart:function(t){var e=this,i=["image/jpeg","image/jpg","image/png"].includes(t.type),a=t.size/1024/1024<=20;return i?a?new Promise((function(e,i){var a=window.URL||window.webkitURL,n=new Image;n.onload=function(){n.width===3*n.height?e():i()},n.src=a.createObjectURL(t)})).then((function(){return t}),(function(){return e.$message({message:"请上传宽高比为3:1的图片，请重新选择!",type:"warning"}),Promise.reject()})):(this.$message.warning("上传局部图片大小不能超过 20MB!"),!1):(this.$message.warning("上传局部图片只能是 jpeg/jpg/png 格式!"),!1)},submitForm:function(){if(!this.ruleForm.bgUrl)return this.$message.warning("请设置背景图片!"),!1;if(!this.ruleForm.positionList.length)return this.$message.warning("请添加定位点!"),!1;var t,e=Object(a.a)(this.ruleForm.positionList.values());try{for(e.s();!(t=e.n()).done;){var i=t.value;if(!(i.name&&i.partImg&&i.device&&i.area&&i.color&&i.humidityMin&&i.humidityMax))return this.$message.warning("有定位点的相关信息未设置，请检查!"),!1;if(!Object(n.b)(i.area)||!Object(n.b)(i.humidityMin)||!Object(n.b)(i.humidityMax))return this.$message.warning("面积、湿度区间只能输入数字，且最多两位小数，请检查!"),!1;if(Number(i.humidityMin)>=Number(i.humidityMax))return this.$message.warning("湿度区间最大值必须大于最小值，请检查!"),!1}}catch(t){e.e(t)}finally{e.f()}this.ajaxPost({url:"/api/facility/pointPosition/addPointPosition",headers:{Access_User_Token:this.userInfo.token},data:this.ruleForm,success:function(){this.$message.success("设置成功!")}})},loadData:function(){this.ajaxPost({url:"/api/facility/pointPosition/findPointPositionList",headers:{Access_User_Token:this.userInfo.token},data:{userId:this.userInfo.id},success:function(t){if(t.data){this.ruleForm=t.data;var e,i=Object(a.a)(this.ruleForm.positionList.values());try{for(i.s();!(e=i.n()).done;){e.value.active=!1}}catch(t){i.e(t)}finally{i.f()}}}})},loadDevice:function(){this.ajaxPost({url:"/api/facility/facility/findFacilityList",headers:{Access_User_Token:this.userInfo.token},data:{userId:this.userInfo.id,nowPage:1,pageSize:50},success:function(t){this.deviceList=t.data.records}})}}},o=(i("7a67"),i("2877")),s=Object(o.a)(r,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-container",[i("el-header",[i("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[i("el-page-header",{attrs:{content:"系统设置"},on:{back:t.goBack}}),i("el-button",{attrs:{type:"primary"},on:{click:t.submitForm}},[t._v("保存设置")])],1)],1),i("el-main",{staticClass:"settings_main"},[i("el-row",{attrs:{type:"flex"}},[i("el-col",{attrs:{offset:2,span:9}},[i("div",{staticClass:"settings_gap_l"},[i("el-upload",{attrs:{action:"/api/file/upload","show-file-list":!1,"on-error":t.handleAvatarFail,"on-success":t.handleAvatarSuccess,"before-upload":t.beforeAvatarUpload,"on-progress":t.handleUploading}},[i("el-button",{attrs:{type:"primary"}},[t._v("上传背景图")]),i("span",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传宽高比为 2:1 的 jpeg/jpg/png 文件，且不超过 20MB")])],1),i("div",{attrs:{id:"garden-box"}},[t._l(t.ruleForm.positionList,(function(e,a){return i("i",{key:a,staticClass:"el-icon-location-outline point",class:{active:e.active},style:{left:e.x,top:e.y},on:{mousedown:function(i){return t.toMove(e,a,i)}}})})),i("div",{staticClass:"garden-box_bg"},[t.ruleForm.bgUrl?i("img",{attrs:{src:"http://122.112.165.72:8010/api/file/upload/"+t.ruleForm.bgUrl,alt:""}}):i("span",[t._v("暂无图片")])])],2)],1)]),i("el-col",{staticClass:"settings_main_r",attrs:{span:9}},[i("div",{staticClass:"settings_gap_r"},[i("el-row",[i("el-button",{attrs:{type:"primary",disabled:!t.ruleForm.bgUrl},on:{click:t.addAnchorPoint}},[t._v("添加定位点")]),i("el-button",{attrs:{type:"primary",disabled:!t.activePoint.active},on:{click:t.deleteAnchorPoint}},[t._v("删除定位点")])],1),i("el-row",{staticClass:"position_msg"},[i("el-form",{ref:"pointForm",attrs:{model:t.activePoint,rules:t.rules,"label-width":"120px",disabled:!t.activePoint.active}},[i("el-form-item",{attrs:{label:"点位名称",prop:"name"}},[i("el-input",{model:{value:t.activePoint.name,callback:function(e){t.$set(t.activePoint,"name",e)},expression:"activePoint.name"}})],1),i("el-form-item",{attrs:{label:"绑定设备",prop:"device"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择设备"},model:{value:t.activePoint.device,callback:function(e){t.$set(t.activePoint,"device",e)},expression:"activePoint.device"}},t._l(t.deviceList,(function(t,e){return i("el-option",{key:e,attrs:{label:t.nickName,value:t.facility}})})),1)],1),i("el-form-item",{attrs:{label:"点位颜色",prop:"color"}},[i("el-color-picker",{model:{value:t.activePoint.color,callback:function(e){t.$set(t.activePoint,"color",e)},expression:"activePoint.color"}})],1),i("el-form-item",{attrs:{label:"面积",prop:"area"}},[i("el-input",{model:{value:t.activePoint.area,callback:function(e){t.$set(t.activePoint,"area",e)},expression:"activePoint.area"}})],1),i("el-form-item",{attrs:{label:"湿度区间",required:""}},[i("el-row",[i("el-col",{attrs:{span:11}},[i("el-form-item",{attrs:{prop:"humidityMin"}},[i("el-input",{model:{value:t.activePoint.humidityMin,callback:function(e){t.$set(t.activePoint,"humidityMin",e)},expression:"activePoint.humidityMin"}})],1)],1),i("el-col",{staticClass:"cc",attrs:{span:2}},[t._v("-")]),i("el-col",{attrs:{span:11}},[i("el-form-item",{attrs:{prop:"humidityMax"}},[i("el-input",{model:{value:t.activePoint.humidityMax,callback:function(e){t.$set(t.activePoint,"humidityMax",e)},expression:"activePoint.humidityMax"}})],1)],1)],1)],1),i("el-form-item",{attrs:{label:"局部环境图片",prop:"partImg"}},[i("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/api/file/upload","show-file-list":!1,"on-error":t.handleAvatarFailPart,"on-success":t.handleAvatarSuccessPart,"before-upload":t.beforeAvatarUploadPart,"on-progress":t.handleUploading}},[t.activePoint.partImg?i("div",{staticClass:"avatar"},[i("img",{attrs:{src:"http://122.112.165.72:8010/api/file/upload/"+t.activePoint.partImg}})]):i("i",{staticClass:"el-icon-plus avatar-uploader-icon"}),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传宽高比为 3:1 的 jpeg/jpg/png 文件，且不超过 20MB")])])],1)],1)],1)],1)])],1)],1)],1)}),[],!1,null,"4aba5090",null);e.default=s.exports},fae5:function(t,e,i){}}]);